<div id="listaCompras">
  <div class="x_panel">
    <div class="x_title">
      <h2>Lista de Compras </h2>                    
      <div class="clearfix"></div>
    </div>
    <div class="x_content">
      <table id="tabela_compras" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>N° </th>
            <th>Fornecedor</th>
            <th>Data</th>    
            <th>Cidade</th> 
            <th>Valor</th>
            <th></th>
          </tr>
        </thead>
        <tbody>    
        </tbody>
      </table>

    </div>
  </div>
</div>


<script>
  $(document).ready(function(){
    $('#tabela_compras').DataTable({ 
      "ajax": {
        "method": "GET",
        "url": "http://localhost/ApiSC/public/compras",
         "data": function(data){
           //console.log(data);
         },
        "dataSrc": function (json) {
          var return_data = new Array();
          for(var i=0;i< json.length; i++){
            var e = json[i].COMPRA_date;
            var e = e.split(" ");
            var dataP = e[0].split("-")
            //dataP = dataP[2].split(" ");			
            var dataResult = dataP[2]+'/'+dataP[1]+'/'+dataP[0];	
            var x = parseFloat(json[i].COMPRA_valor);
					  var svalor = x.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
            return_data.push({
              'COMPRA_id': json[i].COMPRA_id,              
              'FORNECEDOR_nome' : json[i].FORNECEDOR_nome,
              'COMPRA_date' : dataResult,
              'ENDERECO_cidade' : json[i].ENDERECO_cidade,
              'COMPRA_valor' : svalor,
              'btnEdt' : '<button type="button" name="edit" id="'+ json[i].COMPRA_id +'" class="btn btn-success btn-xs">editar</button>'
            })
          }
          return return_data;
        }
      },
      "columns": [
          { "data" : "COMPRA_id"},
          { "data" : "FORNECEDOR_nome"},
          { "data" : "COMPRA_date"},
          { "data" : "ENDERECO_cidade"},
          { "data" : "COMPRA_valor"},
          { "data" : "btnEdt"}
      ],

      "columnDefs": [ 
        {
        "targets": 5,				
        "createdCell": function (td, cellData, rowData, row, col) {
            $(td).css('padding', '5px 0 0 20px')
        }
        },
        { "width": "6%", "targets": 5 }
      ],
    
      "language": {
          "lengthMenu": "Mostrando _MENU_ registros por página",
          "zeroRecords": "Nada encontrado",
          "info": "Mostrando página _PAGE_ de _PAGES_",
          "infoEmpty": " ",
          "infoFiltered": "(filtrado de _MAX_ total records)",
          "search": "Pesquisar:",
          "paginate": {
            "first":      "Primeiro",
            "last":       "Ultimo",
            "next":       "Próximo",
            "previous":   "Anterior"
          }
      },
      order: [[0, "desc"]]
    });

    $('#tabela_compras').on( 'click', "tr button[name='edit']", function (){
    var id = $(this).attr("id");
    var tr = $(this).closest("tr");
		var nFornecedor = tr[0].cells[1].textContent;
    var cidade = tr[0].cells[3].textContent;
    var dataCompra = tr[0].cells[2].textContent;
    $('#listaCompras').val(id);
    
    $('#listaCompras').load('pages/editarCompra.html', function(){
      $('#Npedido').val(id);
      $('#fornecedor').val(nFornecedor);
      $('#cidade').val(cidade);  
      $('#dataCompra').val(dataCompra);
    });
  });

});
</script>